#!/usr/bin/env bash

# Change working directory to user's home directory
cd "${HOME}"

# Reset module environment (may require login shell for some HPC clusters)
module purge && module restore

export SINGULARITYENV_XDG_CONFIG_HOME=$XDG_CONFIG_HOME
containerimg=/n/helmod/apps/centos7/Singularity/xfce/xfce-el7-7.4.1708.img 
#containerimg=/n/helmod/apps/centos7/Singularity/xfce-centos6/xfce-el6fasrc.img
#dbus-uuidgen > mymachid
# Start up desktop
echo "Launching desktop '<%= context.desktop %>'..."
chmod +x "<%= session.staged_root.join("desktops", "#{context.desktop}.sh") %>"
#singularity exec -B ./mymachid:/var/lib/dbus/machine-id  $containerimg "<%= session.staged_root.join("desktops", "#{context.desktop}.sh") %>"
singularity exec  $containerimg "<%= session.staged_root.join("desktops", "#{context.desktop}.sh") %>"
echo "Desktop '<%= context.desktop %>' ended..."
